@model IEnumerable<CookieNotesApp.Models.Note>
@using CookieNotesApp.Models

@{
    ViewData["Title"] = "Dashboard";
    // Retrieve the list of notes the current user has already liked
    var likedIds = ViewBag.LikedNoteIds as List<int> ?? new List<int>();
}

<main style="
    background-color: #FFF8F5;
    width: 100%;
    min-height: 100vh;
    padding: 5vh 5rem 2rem 5rem;
    box-sizing: border-box;
">

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h3 style="font-size: 24px;">
            Community Notes <span style="color: grey;">(Public Feed)</span>
        </h3>

        <div style="display: flex; flex-direction: column; gap: 2rem;">
            <a asp-controller="Friends" asp-action="Index" style="padding: 0.5rem 1.5rem; background-color: #E6D9CB; color: black; text-decoration: none; box-shadow: 0 2px 0 rgba(0,0,0,0.2);">Manage Friends</a>
        </div>
    </div>

    <div style="max-width: 1020px; height: 750px; overflow-y: auto; padding-right: 2rem;">

        @if (!Model.Any())
        {
            <p style="color: #80695C; font-size: 20px;">No public notes yet. Be the first to publish one!</p>
        }
        else
        {
            @foreach (var note in Model)
            {
                bool hasGivenCookie = likedIds.Contains(note.Id);

                <div style="background-color: #E6DDD3; margin-bottom: 3rem; padding: 1.5rem; width: 100%; min-height: 328px; box-sizing: border-box; display: flex; gap: 1.5rem;">
                    
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; width: 200px; shrink: 0;">
                        
                        <button onclick="toggleNoteContent('@note.Id')" 
                                style="width: 120px; height: 120px; border-radius: 20px; background-color: #FFF8F5; border: 4px solid #D6C4B0; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 4px 0 rgba(0,0,0,0.1); transition: transform 0.1s;">
                            <i class="bi bi-list-check" style="font-size: 48px; color: #80695C;"></i>
                            <span style="color: #80695C; font-weight: bold; margin-top: 5px;">View List</span>
                        </button>

                    </div>

                    <div style="flex: 1; display: flex; flex-direction: column;">
                        
                        <div style="text-align: left; color: #80695C; font-size: 24px; margin-bottom: 1rem;">
                            <p style="margin: 0 0 0.5rem 0;">Title: <b>@note.Title</b></p>
                            <p style="margin: 0 0 1rem 0; font-size: 18px;">Author: <b>@(note.Author?.UserName ?? "Unknown")</b></p>
                            
                            <div style="display: flex; gap: 0.75rem; margin-bottom: 1rem;">
                                @if (!string.IsNullOrEmpty(note.Tags))
                                {
                                    @foreach (var tag in note.Tags.Split(' ', StringSplitOptions.RemoveEmptyEntries))
                                    {
                                        <span style="background-color: #D1B2B2; padding: 0.3rem 0.8rem; font-size: 14px; color: black; border-radius: 4px;">
                                            @tag
                                        </span>
                                    }
                                }
                            </div>
                        </div>

                        <div id="note-content-@note.Id" style="display: none; background-color: #FFF8F5; padding: 1rem; border-radius: 8px; border: 2px dashed #D6C4B0; margin-bottom: 1rem; white-space: pre-wrap;">@note.Content</div>

                        <div style="margin-top: auto; display: flex; align-items: center; gap: 1rem;">
                            
                            <form asp-controller="Dashboard" asp-action="GiveCookie" method="post" style="margin: 0;">
                                <input type="hidden" name="noteId" value="@note.Id" />
                                
                                <button type="submit" 
                                        disabled="@(hasGivenCookie ? "disabled" : null)"
                                        style="padding: 0.5rem 1rem; 
                                               background-color: @(hasGivenCookie ? "#D6C4B0" : "#E6D9CB"); 
                                               color: @(hasGivenCookie ? "#666" : "black");
                                               border: none; 
                                               cursor: @(hasGivenCookie ? "default" : "pointer"); 
                                               font-size: 18px; 
                                               box-shadow: @(hasGivenCookie ? "none" : "0 2px 0 rgba(0,0,0,0.2)");">
                                    @(hasGivenCookie ? "Cookie Given! ✓" : "Give a cookie!")
                                </button>
                            </form>

                            <span class="cookie-count" style="font-size: 20px;">🍪: @note.CookieCount</span>
                        </div>

                    </div>
                </div>
                }
        }
    </div>

</main>

<script>
    function toggleNoteContent(id) {
        var contentDiv = document.getElementById('note-content-' + id);
        if (contentDiv.style.display === 'none') {
            contentDiv.style.display = 'block';
        } else {
            contentDiv.style.display = 'none';
        }
    }
</script>